给你一个一把梭的通用公式，直接代入就能算。

# 单次「先涨后跌」模型

**设定**

* 初始本金 PP
* 先上涨 rr（如 30% → r=0.3r=0.3），到价位 P(1+r)P(1+r)
* 在该价位**卖出比例** xx（如 50% → x=0.5x=0.5）
* 之后价格回落到 **开仓价的 −d-d** （如 -30% → d=0.3d=0.3），即价位 P(1−d)P(1-d)
* 剩余仓位 (1−x)(1-x) 在 P(1−d)P(1-d) 平掉/止损

**最终资产**

A  =  P[(1+r)x  +  (1−d)(1−x)]  =  P[(1−d)  +  x(r+d)]A \;=\; P\Big[(1+r)x \;+\; (1-d)(1-x)\Big]
\;=\; P\Big[(1-d) \;+\; x(r+d)\Big]
**最终收益率**

AP−1  =  −d  +  x(r+d)\frac-1 \;=\; -d \;+\; x(r+d)
-------------------------------------------------------------

## 保本所需卖出比例（关键结论）

要求 A≥PA\ge P：

(1−d)+x(r+d)  ≥  1    ⇒    x  ≥  dr+d(1-d) + x(r+d) \;\ge\; 1
\;\;\Rightarrow\;\;
x \;\ge\; \frac{d}{r+d}

* 例1：涨30%后，跌到-30%保本

  x\*=0.30.3+0.3=0.5x^\*=\frac{0.3}{0.3+0.3}=0.5 → 上涨30%时**至少卖 50%** 才能保证随后跌到-30%不亏。
* 例2：涨60%后，跌到-60%保本

  x\*=0.60.6+0.6=0.5x^\*=\frac{0.6}{0.6+0.6}=0.5 → 上涨60%时**至少卖 50%** 即可保本；你卖 62% 则盈利 −0.6+0.62×1.2=+0.144 -0.6+0.62\times1.2=+0.144（+14.4%）。

---

## 三个“随手算”心法

1. **保本卖出线** （先涨到 rr 再跌到 −d-d）

x\*=dr+d\boxed{x^\*=\frac{d}{r+d}}
只要 x≥x\*x \ge x^\* ，即使后面跌到 −d-d 也不亏。

2. **极端防“归零”线** （确保后面即使归零也不亏）

x  ≥  11+r\boxed{x \;\ge\; \frac{1}{1+r}}
因为先套现 P(1+r)x≥PP(1+r)x \ge P ，后面就算清零也保本。

（这条比保本线更保守，要求更高。）

3. **直接算收益** （不用回代）

ROI=−d+x(r+d)\boxed{\text{ROI} = -d + x(r+d)}
看到 r,d,xr,d,x 就能一眼算出最终盈亏百分比。

---

## 快速对照（举三个常见组合）

* r=30%, d=30%r=30\%,\, d=30\%：

  保本线 x\*=0.5x^\*=0.5。

  若 x=0.3x=0.3 → ROI =−0.3+0.3×0.6=−12%=-0.3+0.3\times0.6=-12\%（对应你最早的例子）。
* r=50%, d=30%r=50\%,\, d=30\%：

  x\*=0.30.8=37.5%x^\*=\frac{0.3}{0.8}=37.5\%。

  卖 40% → ROI =−0.3+0.4×0.8=+2%=-0.3+0.4\times0.8=+2\%。
* r=60%, d=60%r=60\%,\, d=60\%：

  x\*=0.5x^\*=0.5。

  卖 62% → ROI =−0.6+0.62×1.2=+14.4%=-0.6+0.62\times1.2=+14.4\%。

---

# 多次分批止盈的推广

若分多次在不同涨幅 rir_i 卖出比例 xix_i（总卖出 ∑xi≤1\sum x_i \le 1），之后回落到 −d-d：

AP=∑ixi(1+ri)+(1−∑ixi)(1−d)=(1−d)+∑ixi(ri+d)\frac{A}{P}
= \sum_i x_i(1+r_i) + (1-\sum_i x_i)(1-d)
= (1-d) + \sum_i x_i(r_i + d)
**保本条件**

(1−d)+∑ixi(ri+d)  ≥  1    ⟺    ∑ixi(ri+d)  ≥  d(1-d) + \sum_i x_i(r_i + d) \;\ge\; 1
\;\;\Longleftrightarrow\;\;
\boxed{\sum_i x_i(r_i + d) \;\ge\; d}
这句白话就是： **你在较高位置卖出的“加权强度”要覆盖后续的回撤幅度 dd** 。

---

# 策略启示（可直接落地）

* 想在“跌到 -dd”时不亏，就在任一到达的止盈点，**至少**按 x\*=dr+dx^\*=\dfrac{d}{r+d} 卖出。涨得越多、或你容忍的回撤越小，所需卖出的比例就越小。
* 想铁壁“反诈”（后面哪怕清零也不亏），在任一到达的止盈点按 x≥11+rx\ge \dfrac{1}{1+r} 卖出。
* 做分批：让 ∑xi(ri+d)≥d\sum x_i(r_i+d)\ge d。优先把卖出额度放在**更高的 rir_i** 上，效率更高。

需要我把这三条做成一张 A4 公式卡（含几组常见 r,dr,d 的速查表）方便打印贴墙？
